# 18 네트워크 프로그래밍
## 18-1 스마트폰 정보 구하기
### 전화 상태 변화 감지하기
- `PhoneStateListener` : Android 12에서 deprecated 됨
- `TelephonyCallback` : `TelephonyManager`에 등록하면 상태가 변화했을 때 `TelephonyCallback` 함수가 자동으로 호출됨

스마트폰 상태 퍼미션
```Kotlin
<uses-permission android:name="android.permission.READ_PHONE_STATE" />
```

네트워크 제공 국가, 사업자, 전화번호 얻기 - `TelephonyManager`
- `getNetworkContryIso()` : 네트워크 제공 국가
- `getNetworkOperatorName()` : 네트워크 제공 사업자

사용자 전화번호를 읽는 퍼미션
```Kotlin
<uses-permission android:name="android.permission.READ_PHONE_NUMBERS" />
```

네트워크 접속 정보 - `ConnectivityManager`
- 1. `getActiveNetwork()` 이용하는 방법
  ```Kotlin
  <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
  ```
  - `ConnectivityManager`의 `getActiveNetwork()`로 `Network` 객체를 얻어서 사용함
  - `activityNetwork` 정보가 Null : 현재 스마트폰은 네트워크에 접속할 수 없음
  - `getNetworkCapabilities()`의 매개변수로 지정 시 현재 접속된 네트워크의 정보를 얻을 수 있음

- 2. `requestNetwork()` 이용하는 방법
  ```Kotlin
  <uses-permission android:name="android.permission.CHANGE_NETWORK_STATE" />
  ```
  - 네트워크 타입 지정 후 `requestNetwork()`로 넘어가 `onAvailable()`이 호출되면 지정한 타입의 네트워크가 가능하다는 의미임

## 18-2 HTTP 통신하기
- 인터넷 퍼미션 선언
- HTTPS가 아닌, HTTP 프로토콜로 통신 시 특정 도메인만 허용하도록 선언해줘야 함
- res/xml 폴더에xml 파일을 만들어 아래와 같이 작성
```Kotlin
<network-security-config>
  <domain-config cleartextTrafficPermitted="true">
    <domain includeSubdomains="true">xxx.xxx.xxx.xxx</domain>
  </domain-config>
</network-security-config>
```

- Volley 라이브러리
  - 2013년 구글 IO 행사에서 공개된 라이브러리
  - 안드로이드 앱에서 HTTP 통신을 좀 더 쉽게 구현하게 해줌
  - dependencies 등록
  ```Kotlin
  implementation("com.android.volley:volley:1.2.1")
  ```
  - `RequestQueue` : 서버에 요청을 보내는 역할
  - `XXXRequest` : 서버 URL과 결과를 가져오는 콜백 등의 정보
    - GET : 간단하게 URL 뒤에 데이터를 추가해서 전달
    - POST : `StringRequest`를 상속받은 클래스를 이용함

    - 화면 출력용 이미지 데이터 요청하기 - NetworkImageView
      - 레이아웃 xml에 `<com.android.volley.toolbox.NetworkImageView>` 작성 -> `setImageUrl()` 호출 (통신, 출력 모두 포함)
      - `ImageLoader`의 `getBitmap()` 반환값이 NULL이면 서버에 요청을 보내고, Bitmap 객체이면 요청을 보내지 않고 `NetworkImageView`에 출력함
      - 같은 URL의 이미지를 반복해서 안 가져오도록 함

    - JSON 데이터 요청 - JsonObjectRequest
      - JSON 오브젝트 전달 시 이 객체의 getter 함수를 사용해 가져올 데이터의 키값을 명시함
    - JSON 배열 요청 - JsonArrayRequest
      - val jsonObject = response[i] as JSONObject
