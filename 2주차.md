# 10 다이얼로그와 알림 이용하기
## 10-1 API 레벨 호환성 고려하기
- `minSdk` : 이것부터 설치 가능 
- `targetSdk` : 이 버전의 API로 앱 개발
=> 따라서 `minSdk` 설정값보다 상위 버전의 API를 사용한다면 compatibility(호환성)를 고려해야 함 -> 이를 위해 안드로이드 API 문서를 참고함

- API 레벨 호환성에 문제가 있는 API를 사용할 때 annotation을 추가해 오류를 해결할 수 있음(`@RequiresApi` 혹은 `@TargetApi`)
  -> 이 annotation은 안드로이드에서 오류를 무시하는 설정일 뿐이며, 앱 실행 시 문제를 막으려면 직접 코드로 처리해야 함.

```Kotlin
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {
  ...
}
```

- `Build.VERSION.SDK_INT` : 앱이 실행되는 기기의 API 레벨'

## 10-2 퍼미션 설정하기
- `permission` : 앱의 특정 기능에 부여하는 접근 권한. 다른 앱이나 안드로이드 시스템에서 보호하는 특정 기능을 이용할 때 퍼미션 사용을 설정해야 함
  - `<permission>` : 기능을 보호하려는 앱의 manifest 파일에 설정
  - `<uses-permission>` : 퍼미션으로 보호된 기능을 사용하려는 앱의 manifest 파일에 설정
 
- `protectionLevel`
  - `normal` : 이 기능을사용하는 앱이 퍼미션 사용설정을 해야 하지만, 사용자에게 권한 허용을 요청하지는 않아도 됨
  - `dangerous` : 퍼미션 사용 설정, 사용자에게도 권한 허용을 요청해야 함
 
- 퍼미션 허용 확인 정책의 변경
  - 기존 (API 1 ~ 22) : manifest 파일에 `<uses-permission>`으로 선언만 하면 보호받는 기능을 앱에서 이용하는 데 문제 x
  - 현재 (API 23 ~  ) : 개발자가 `<uses-permmision>`으로 선언하였더라도, 사용자가 권한 화면에서 이를 거부할 수 있게 됨
    => 사용자가 permission을 거부했는지 확인하고, 거부했으면 다시 permission을 허용해달라고 요청해야 함
```Kotlin
open satic fun checkSelfPermission(
  @NonNull context: Context,
  @NonNull permission: String
): Int
```

사용자가 퍼미션을 거부한 경우
```Kotlin
public final <I, O> ActivityRessultLauncher<I> register
ForActivityResult(
  @NonNull ActivityResultContract<I, O> contract,
  @NonNull ActivityResultCallBack<O> callback)
```

퍼미션 허용 요청 확인
```Kotlin
val requestPermissionLauncher = registerForActivityResult(
  ActivityResultContracts.RequestPermission()
) { isGranted ->
  if (isGranted) {
    Log.d("kkang", "callback, granted..")
  } else {
    Log.d("kkang", "callback, denied..")
  }
}
```

퍼미션 허용 요청 실행
```Kotlin
requestPermissionLauncher.launch("android.permission.ACCESS_FINE_LOCATION")
```

## 10-3 다양한 다이얼로그
- `dialog` : 사용자와 상호작용하는 대화상자.
  - `toast` : 화면 아래쪽에 잠깐 보였다가 사라지는 문자열. 사용자에게 간단한 메시지로 특정한 상황을 알리기 위해 사용함
    - `makeTest()` 사용함. 사용하지 않고 setter 함수를 이용해 만들 수도 있음
    - `Toast.LENGTH_SHORT` : 3초 정도
    - `Toast.LENGTH_LONG` : 5초 정도
    - toast가 화면에 보이거나 사라지는 순간을 콜백으로 감지해 특정 로직을 수행하게 할 수도 있음 (API 30 ~ )
   
- 날짜 또는 시간 입력 받기
  - `picker dialog` : 앱에서 사용자에게 날짜나 시간을 입력받는 데 사용하는 다이얼로그
  - `DatePickerDialog` : 날짜 입력받을 때 사용
  - `TimePickerDialog` : 시간을 입력받을 때 사용

- 알림 창 띄우기
  - `AlertDialog` : 메시지 혹은 다양한 화면을 출력할 수 있음
  - 알림 창의 constructor는 protected이기 때문에 객체를 직접 생성할 순 없으나, `AlertDialog.Builder`를 제공하므로 이를 이용해 알림 창을 만들 수 있음
  - 이후 builder의 setter function을 이용해 알림 창의 정보를 지정함.
  - 알림창의 버튼은 최대 3개까지만 추가 가능함.
  - 알림창에 목록 제공 후 하나를 선택받고 싶다면 `setItems()` 등등 사용

```Kotlin
Log.d("kkang", "${items[p1]} 이 ${if(p2) "선택되었습니다." else "선택 해제되었습니다."}")
```
위 예시처럼, parameter값이 문자열이어도 if ~ else 구문을 사용할 수 있다.

## 10-4 소리와 진동 알림
- 알림음 : 새로운 메시지를 전달받았을 시의 사용자 알림 효과
  - `RingtonManager.getDefaultUri`로 소리를 얻거나, 앱에서 자체 음원을 준비하는 방법이 있음(`res/raw`)
    
- 진동 : `<uses-permission>`으로 permission을 얻음
  - `Vibrator` 클래스를 이용함
  - API 31 이전 : `VIBRATOR_SERVICE`로 식별되는 시스템 서비스 이용
  - API 31 이후 : `VIBRATOR_SERVICE`로 식별되는 `VibratorManager`라는 시스템 서비스를 얻고, 이 서비스에서 `Vibrator`를 이용해야 함

- 시간과 패턴을 지정해 진동 울리기 (API 1 ~ 25)
  - API 26부터 deprecated 됨 (사용 보장할 수 없어 사용하지 말 것)
- 진동의 세기까지 지정해 진동 울리기 (API 26 ~ )
  - `VibrationEffect` 객체로 진동 정보를 저장할 수 있음
  - 진동 세기까지 제어할 수 있음

## 10-5 알림 띄우기
- 알림(notification) : 상태바에 앱의 정보를 출력하는 것
- API 33부터 사용자에게 permission을 요청해야 함
- `NotificationManager`의 `notify()`로 발생함.
- `NotificationChannel`로 알림 채널 만듦 -> 이 채널 정보를 대입해 `NotificationCompat.Builder`를 만듦 -> 이 빌더로 Notification 객체를 만듦
  - 빌더를 만드는 방법이 API 26부터 변경됨. `channelId`를 parameter로 넘겨줘야 함

